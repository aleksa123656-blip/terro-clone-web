<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { margin:0; background:#111; color:white; font-family:-apple-system; padding:10px; }
    .item { display:flex; background:#222; margin:10px; border-radius:12px; padding:10px; align-items:center; }
    .item img { width:60px; height:60px; border-radius:8px; margin-right:10px; }
    .qty { display:flex; background:#333; border-radius:20px; padding:5px; margin-left:auto; }
    .qty button { background:none; border:none; color:white; width:30px; }
    .total { padding:20px; font-size:18px; }
    .checkout { background:#007aff; color:white; padding:15px; text-align:center; border-radius:12px; margin:20px 10px; }
  </style>
</head>
<body>
  <div id="items"></div>
  <div class="total" id="total">Итого: 0 ₽</div>
  <div class="checkout" onclick="submitOrder()">Оформить заказ</div>

  <script>
    Telegram.WebApp.ready();

    const products = {
      1: { name:"Tora Bomber", price:8890 },
      2: { name:"Sang Hoodie", price:2990 }
    };

    function render() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const container = document.getElementById('items');
      container.innerHTML = '';
      let total = 0;

      cart.forEach((item, i) => {
        const p = products[item.id];
        const sum = p.price * item.qty;
        total += sum;
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
          <img src="https://i.imgur.com/${item.id === 1 ? '5eQe9dO' : 'XyZ1234'}.jpeg">
          <div style="flex:1">
            <div>${p.name}</div>
            <div style="color:#aaa">${p.price} ₽ × ${item.qty}</div>
          </div>
          <div class="qty">
            <button onclick="update(${i}, -1)">−</button>
            <span>${item.qty}</span>
            <button onclick="update(${i}, 1)">+</button>
          </div>
        `;
        container.appendChild(div);
      });

      document.getElementById('total').textContent = `Итого: ${total} ₽`;
    }

    window.update = (i, d) => {
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      cart[i].qty += d;
      if (cart[i].qty <= 0) cart.splice(i, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      render();
    };

    window.submitOrder = () => {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const total = cart.reduce((s, i) => s + products[i.id].price * i.qty, 0);
      const order = {
        action: 'submit_order',
        cart: cart,
        total: total,
        timestamp: new Date().toLocaleString('ru-RU')
      };
      Telegram.WebApp.sendData(JSON.stringify(order));
      Telegram.WebApp.close();
    };

    render();
  </script>
</body>
</html>